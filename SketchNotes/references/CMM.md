# 摘要
Count-min是一种通用的数据流概要技术，可用于回答多种类型的近似查询，如多发性（又名点）查询，连接和自连接大小估算，与已知的最佳替代方案相比，它具有一些不错的特性，如单侧错误保证，更好的空间界限和对高度倾斜数据的更准确估算。然而，根据我们在合成和真实数据集上对多发性查询和自连接大小估算的实验，我们发现，实际上以前的Count-min估算算法仅在数据集高度倾斜时表现良好；在其他情况下，这些算法提供的准确度比Fast-AGMS（又名Count-sketch）低得多，后者是基于有影响力的抽样子技术AMS sketch的改进。
本文基于现有的Count-min数据结构，提出了两种新的用于多发性查询和自连接大小估算的估算算法，这些算法在数据集不倾斜的情况下与以前的Count-min估算算法相比显着提高了估算准确性，这正是以前的算法表现不佳的地方。此外，无论输入数据的分布如何，我们在理论上和实践上都表明，我们的算法的性能与Fast-AGMS非常相似。因此，我们主张使用新的和以前的估算算法，Count-min比Fast-AGMS更灵活和更强大，因为使用我们的新估算算法，Count-min在估算准确度和时间效率方面几乎与Fast-AGMS相同，而使用以前的估算算法，Count-min具有其他不错的属性。

# 1 引言
数据流处理在数据库领域引起了极大的兴趣。该领域的一些工作集中于构建数据流管理系统，而其他工作则开发数据流处理算法，旨在解决特定问题，这既有利于数据流系统，又有利于特定应用程序（参见[3，26]）。一个典型的数据流应用程序，如实时IP流量分析，需要大量的空间和极高的处理速度。在主干路由器上，几吉比特的数据可以在一秒钟内到达；这使得实时分析具有挑战性，因为大型存储器（例如磁盘，有时甚至是普通的DRAM[15]）不够快，无法跟上数据到达的速度，而快速的RAM通常与数据量相比是有限的。因此，在这些实时应用程序中，算法的时间和空间效率都非常重要。

一般来说，数据流是一个元组的序列，通常根据它们的到达顺序进行排序。数据流草图（或草图）是简洁的数据摘要，在一次遍历中构建以回答特定查询，可能存在误差。在诸如实时IP流量分析、传感器网络监控、网络点击跟踪等流应用程序中，草图是有用且重要的。在某些其他场景中，例如大规模数据分析，草图也是有帮助的。尽管在这些应用程序中数据是静态的并存储在磁盘上，但多次遍历数据集以准确回答某些查询的成本太高。在一次遍历中获得带有误差的估计可能更可取。已经提出了各种时间空间效率高的草图技术，有些专门用于一种类型的查询，而少数其他技术，如Count-min [10]和Fast-AGMS草图（又称Count-sketch） [5]，可以用于回答多个查询。可以使用Count-min或Fast-AGMS草图回答的两个重要查询是多发性查询和自连接大小估算。虽然我们的估算算法可以扩展到回答其他查询，但本文重点讨论这两个查询。

多发性查询，也称为点查询或频率查询，是查找给定元素在数据流中出现的次数。这是一个重要的查询，因为回答多发性查询的技术通常可以应用于回答其他与频率相关的查询，例如冰山查询[6]（目标是找到频率超过阈值的元素），找到最频繁的K个元素[5]，范围查询[10]（目标是找到范围内元素的频率之和），以及近似分位数[10]。多发性查询在传统的非流式环境中也很重要（更多例子请参见[6]）。
一个多重集的自连接大小，也称为第二频率矩，是D中所有值i的频率fi的平方的和，其中D是值的取值范围。自连接大小表示数据集的倾斜程度。对于诸如Zipfian和指数分布这样的数据分布，自连接大小唯一地确定了分布的参数[1]。知道分布的参数可以提高估计的准确性。例如，在回答多发性查询时，我们可以计算输入数据流的Zipfian参数（假设它遵循Zipfian模型），并相应地选择本文提出的新算法和以前提出的算法之一，因为两种算法都基于相同的草图。另一个例子是，自连接大小在选择最佳采样策略来估计不同值的数量时也是有用的[18]。更多自连接大小的应用可以在[2]和[1]中找到。

为了回答多发性查询和自连接大小估算，我们关注Count-min草图[10]，该草图已用于实时IP流量分析（包括多发性查询和自连接大小估算）和其他操作原因的运营数据流监测系统，AT&T的Gigascope[12,9]。Count-min具有一些很好的属性，例如单侧错误和更好的空间界限（比已知最佳替代草图技术小1/ǫ，其中ǫ是相对误差）。但是，更好的空间界限并不总是保证在实践中更好的性能。根据我们的实验，我们发现，使用Count-min的先前估算算法，称为CM，不如在各种数据集上使用Fast-AGMS[5]准确。特别是在稍微倾斜或均匀分布的数据集上，Fast-AGMS表现明显更好。在本文中，我们证明Count-min草图无论数据分布如何，实际上都可以与Fast-AGMS一样好，无论数据分布如何，都可以在理论上和实践上使用我们新的估算算法。此外，我们新的估算算法可以与以前算法不冲突地结合使用，从而使Count-min成为更强大、更灵活的草图。

# 1.1 我们的贡献
首先，我们提出了一种基于Count-min草图[10]的无偏估计算法（简称CMM），用于近似回答数据流的多种性查询。合成和真实数据集的实验表明，新算法在除高度倾斜数据集之外的大多数数据集上提供了更准确的结果（例如，在真实数据集上的数量级改进）。
其次，通过理论分析和实验评估，我们发现CMM与基于Fast-AGMS草图的算法表现非常相似[5，8]，并且Fast-AGMS的所有分析结果[5]也适用于我们的CMM算法。因此，Count-min也可以应用于Fast-AGMS用作构建块的案例，且不会损失精度、时间和空间效率（例如[19]和[17]）。

具有不同属性的两种估计选项，Count-min能够超越Fast-AGMS。例如，CM估计方法提供了一侧的错误近似，在某些情况下这可能是非常有用的。在数据流中查找频繁元素时，使用CM估计可以保证返回所有乘法超过给定阈值的候选者。所有合格的候选者的多种性估计可以通过我们的CMM方法获得，因为在实际中它通常更准确。相比之下，Fast-AGMS无论给定多少空间都无法提供这种确定性保证。此外，当数据集高度倾斜时，使用CM的Count-min比Fast-AGMS更准确，并且CM具有更好的空间界限，这意味着给定误差界限和置信区间，使用CM的Count-min需要比Fast-AGMS更少的空间。

# 1.2 论文提纲
本论文的其余部分组织如下。第2节给出了Count-min草图和其他两个比较替代品的背景知识。然后，我们在第3节介绍了用于多种性查询的CMM估计算法，其中提供了分析和实验结果。第4节讨论了用于自连接大小估计的CMM算法。第5节描述了与我们的研究工作密切相关的工作。第6节总结了本文。

...

# 3 使用Count-min草图的多种性查询的无偏估计
第2.1节中描述的估计过程给出了真实值的上界。我们提出了我们的估计方法，即count-mean-min（CMM），它使用完全相同的Count-min草图对多种性查询和自连接大小估计给出无偏估计。本节讨论多种性查询的情况

# 3.1 基本思想
回想一下CM的估计过程：给定查询元素q和哈希函数hi（i = 0，...，d-1），频率估计^fq是q触及的计数器的最小值（即CM[i，hi（q）]，i = 0，...，d-1）。通常，q触及的计数器也被其他元素触及，因此即使是最小的计数器值也期望大于真实值fq。误差的来源是除q以外的其他元素对计数器CM[i，hi（q）]的贡献。我们将除q以外的元素对计数器CM[i，hi（q）]的贡献特征化为噪声。CM算法返回具有最小噪声的计数器值。我们的CMM算法尝试估计每个计数器的噪声，去除噪声并返回余量。
当然，我们并不确切知道噪声的值，因为噪声是一个随机变量，但我们可以通过预期值对其进行估计。对于计数器CM[i，hi（q）]，噪声可以从该行中未被q触及的所有其他计数器的值来估计。每个未被q触及的计数器的值可以被认为是独立的随机变量，遵循与噪声相同的分布，假设哈希函数以均匀随机的方式映射每个元素i到范围[0，d-1]（两两独立足以满足本节的理论结果）。事实上，对于多种性查询，在行i中未被查询元素q触及的计数器的值表明了计数器CM[i，hi（q）]中的噪声的概率分布。

# 3.2 我们的估计算法
给定查询元素q，我们使用与构建Count-min草图时使用的相同的哈希函数hi（i = 0，...，d-1），并检查映射到查询元素q的d个计数器，即CM[i，hi（q）]（i = 0，...，d-1）。我们不是返回d个计数器的最小值，而是从d个计数器中的每个计数器中扣除估计的噪声的值，并返回d个残留物的中位数。每个计数器CM[i，hi（q）]的估计噪声可以计算为除计数器CM[i，hi（q）]本身之外的行i中所有计数器的平均值。即噪声估计为（N-CM[i，hi（q）]）/（w-1），其中N是流大小，w是草图宽度。